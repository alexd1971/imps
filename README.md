# Image processing service (imps)

Сервис обработки изображений

На данный момент реализовано только изменение размера изображения в формате `JPEG` и `PNG`

## Запуск сервиса

```sh
docker run --rm -d --name imps -p 7777:7777 <repository>/imps:<tag>
```

Если не нужно, чтобы сервис слушал на localhost, то порт можно не пробрасывать

## Запрос к сервису

### Изменение размера изображения

Для изменения размера изображения необходимо:
- сформировать `POST`-запрос к сервису:
    - передать в теле запроса изображениe
    - установить заголовок `Content-Type` либо `image/jpeg`, либо `image/png` в зависимости от формата изображения.
    - Значения параметров запроса `w` и `h` определяют требуемые размеры изображения. Обязательно должен быть хотя бы один из параметров размера
    - параметр `q` определяет качество `JPEG` изображения. Значение параметра `q` должно быть в пределах от 0 до 100. Если параметр `q` не указан, то будет использовано некоторое значение по умолчанию обеспечивающее удовлетворительное качество.
    - параметр `r` определяет правило изменения размера изображения. Допустимы два значения: `contain` и `cover`. При использовании `contain` (это правило используется по умолчанию) изображение вписывается в указанный прямоугольник со сторонами `w` и `h`. При использовании `cover` изображение полностью заполняет прямоугольник со сторонами`w` и `h` и при необходимости подрезается. Например:
        - resize?w=x&h=y&q=80  или resize?w=x&h=y&q=80&r=contain - делает резайз изображения так, чтобы оно полностью помещалось в прямоугольник со сторонами x, y. В итоге одна сторона имеет требуемый размер, а вторая - как получится, но не больше требуемого
        - resize?w=x&h=y&q=80&r=cover - делает ресайз изображения так, чтобы одна из сторон вписалась в требуемые размеры, а вторая подрезалась до нужного размера. В итоге картинка всегда получается с размерами x, y
        - При указании одного размера, например, resize?w=x&q=80 или resize?h=y&q80, независимо от значения параметра r указанный размер изображение ресайзится до требуемого значения, а второй вычисляется автоматически для сохранения пропорций.

#### Пример `curl`-запроса

```sh
curl -X POST -H "Content-Type: image/jpeg" --data-binary @/path/to/image.jpg  "http://localhost:7777/resize?h=1000&w=1000&q=80&r=cover" >> ~/Downloads/out.jpg
```

Исходное изображение находиться в файле `/path/to/image.jpg`. Результирующее изображение будет размещено в `~/Downloads/out.jpg`.

#### Логика обработки изображения

Изменение размеров изображения всегда происходит без искажения пропорций.

Изображение автоматически поворачивается на основе метаданных об ориентации.
